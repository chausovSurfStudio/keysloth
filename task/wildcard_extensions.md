# Wildcard extensions: поддержка любых типов файлов

## Цель
Убрать ограничение на список поддерживаемых расширений. Инструмент должен шифровать/дешифровывать любые типы файлов в указанной директории, сохраняя текущую модель хранения `.enc` в репозитории.

## Объём работ
- Сбор входных файлов: из whitelist расширений → на «все файлы», с разумными исключениями.
- Безопасная работа с бинарными файлами.
- Обновление CLI и документации.
- Актуализация тестов и тест-плана.

## План задач
1) Обновить сбор файлов в `FileManager#collect_secret_files`
   - Рекурсивно собирать все обычные файлы (`File.file?`) в заданной директории.
   - Исключить из выбора: `**/*.enc`, `**/.git/**`.
   - Дополнительно исключить общеизвестные мусорные файлы по умолчанию: `.DS_Store`, `Thumbs.db`, локальный `README.md` в каталоге секретов.
   - Подготовить точку расширения для будущей настройки include/exclude через конфиг (без реализации, если не требуется сейчас).

2) Обеспечить бинарно-безопасный I/O
   - Перейти на `File.binread`/`File.binwrite` в `FileManager` и местах использования (чтение/запись секретов).
   - Проверить, что `Crypto` корректно работает с бинарными строками (подтвердить тестами).

3) Проверки целостности файлов
   - Сохранить специализированные проверки для известных типов (`.cer`, `.p12`, `.mobileprovisioning`, `.json`).
   - Для всех прочих типов — базовая проверка (не пустой, читаемый), не блокирующая обработку.

4) Обновить CLI help и генерацию README секретов
   - Удалить жёсткий список «поддерживаемых типов» из long_desc в `lib/keysloth/cli.rb`.
   - В шаблоне README для директории секретов указать: «поддерживаются любые типы файлов».
   - Убедиться, что создаваемый локально `README.md` НЕ попадает под шифрование/отправку.

5) Обновить основную документацию
   - В `README.md` заменить раздел «Поддерживаемые типы файлов» на «любой тип файла (примеры: .cer, .p12, .json, изображения, бинарные и т.д.)».
   - Добавить примечание про исключения (`*.enc`, `.git/**`, `.DS_Store`, `Thumbs.db`, `README.md`).

6) Тесты
   - Расширить `spec/keysloth/file_manager_spec.rb`:
     - кейс: собираются разные типы файлов (например, `.txt`, `.png`, `.bin`).
     - кейс: игнорируются `.enc` и `.git` содержимое, а также `README.md`.
     - кейс: корректный сбор в вложенных директориях.
   - Адаптировать тесты, завязанные на whitelist.

7) Тест-план
   - Обновить `task/test_plan.md`: добавить сценарии для произвольных расширений и бинарных файлов, проверку побайтной идентичности после `push`→`pull`.

8) Релизная подготовка
   - Обновить `CHANGELOG.md`.
   - Поднять версию gem (patch/minor).

## Критерии приёмки
- `push` шифрует все файлы из указанной директории (и подпапок), кроме исключений по умолчанию, и публикует их как `<relative_path>.enc`.
- `pull` корректно расшифровывает любые `.enc` и восстанавливает исходные имена и содержимое.
- Бинарные файлы (например, `.png`, `.p12`) после цикла `push`→`pull` побайтно идентичны исходникам (проверка через хэш).
- Тесты проходят локально и в CI.

## Риски и меры
- Большие файлы: текущая реализация читает файлы целиком в память;
- Случайные/мусорные файлы: добавлены исключения; при необходимости сделать настраиваемыми через конфиг.

## Замечания по обратной совместимости
- Прежние проекты продолжат работать; расширение функциональности не требует миграций.
- Пользователи могут удалить упоминания конкретных расширений из своих внутренних инструкций.

## SSH fixes: улучшение UX и сообщений об ошибках

### Цели
- Улучшить сообщения об ошибках SSH/аутентификации с практичными подсказками.
- Обновить README: явно указать поддержку `id_ed25519`, примеры использования ENV и `KEYSLOTH_SSH_KEY_PATH`.
- По возможности покрыть тестами типовые SSH‑ошибки.

### Вне scope
- Не добавляем CLI‑флаг `--ssh-key`.
- Не обновляем test plan.

---

### План работ

#### 1) Документация (`README.md`)
- Обновить раздел «Настройка SSH ключей»:
  - Добавить рекомендации по `ed25519` (современный алгоритм по умолчанию):
    - Генерация: `ssh-keygen -t ed25519 -C "you@example.com"`.
    - Проверка публичного ключа: `cat ~/.ssh/id_ed25519.pub`.
  - Ясно указать, что системный SSH и ssh-agent автоматически поддерживают как `id_rsa`, так и `id_ed25519`.
- Обновить раздел «CI/CD настройка»:
  - Уточнить, что `SSH_PRIVATE_KEY` может содержать любой тип ключа (ed25519/rsa).
  - Добавить упоминание `KEYSLOTH_SSH_KEY_PATH` для явного указания пути к ключу.
- Раздел «Использование системного SSH (GIT_SSH_COMMAND)»:
  - Описать авто‑формирование `GIT_SSH_COMMAND` при наличии ENV (`SSH_PRIVATE_KEY`/`SSH_PUBLIC_KEY` или `KEYSLOTH_SSH_KEY_PATH`).
  - Отдельно отметить рекомендации про StrictHostKeyChecking только для CI.
- Раздел «Troubleshooting → Ошибки аутентификации Git»:
  - Добавить подсказки для Ed25519: проверка агента `ssh-add -l`, загрузка ключа `ssh-add ~/.ssh/id_ed25519`.
  - Добавить подсказку про `KEYSLOTH_SSH_KEY_PATH` и ENV `SSH_PRIVATE_KEY` как быстрые способы указать ключ.

Готово, когда: README явно содержит `ed25519`, `KEYSLOTH_SSH_KEY_PATH` и универсальность `SSH_PRIVATE_KEY`.

#### 2) Улучшение ошибок SSH (код: `lib/keysloth/git_manager.rb`)
- В `run_git` добавить распознавание типовых SSH‑ошибок и расширенные советы:
  - При `Permission denied (publickey)`:
    - Советы: проверить ключи в агенте `ssh-add -l` (или загрузить: `ssh-add ~/.ssh/id_ed25519`),
      указать ключ явно `KEYSLOTH_SSH_KEY_PATH=~/.ssh/id_ed25519` или использовать `SSH_PRIVATE_KEY` в CI,
      проверить права на ключ `chmod 600 ~/.ssh/<key>`.
  - При `Host key verification failed`:
    - Советы: добавить хост в known_hosts `ssh-keyscan <host> >> ~/.ssh/known_hosts`,
      избегать отключения проверки хостов вне CI.
  - При `Repository not found`/`Could not read from remote repository`:
    - Советы: проверить URL репозитория и доступ (приглашение/права).
- Сохранить текущее общее сообщение‑совет как fallback, если паттерн не распознан.
- Убедиться, что в сообщениях не выводятся секреты/ключи.

Готово, когда: `RepositoryError` содержит релевантные советы для распознанных паттернов.

#### 3) Тесты (по возможности) — `spec/keysloth/git_manager_spec.rb`
- Добавить группу: «SSH ошибки и подсказки».
  - Кейс: stderr содержит `Permission denied (publickey)` → ошибка содержит подсказки про `ssh-add -l`, `KEYSLOTH_SSH_KEY_PATH`, `SSH_PRIVATE_KEY`.
  - Кейс: stderr содержит `Host key verification failed` → ошибка содержит подсказку про `ssh-keyscan … >> ~/.ssh/known_hosts`.
  - Кейс: stderr содержит `Repository not found` → ошибка содержит подсказку про проверку URL/прав доступа.
  - Кейс: произвольный stderr → остаётся общий совет.
- Техподход:
  - Мокнуть `Open3.capture3` на неуспех с требуемым stderr.
  - Вызвать любой публичный путь, который триггерит `run_git` (например, `clone_repository`/`ensure_branch_up_to_date`) или обратиться через `send` к приватному методу, не ломая интерфейс.

Готово, когда: новые спеки зелёные и не ломают существующие.

#### 4) CHANGELOG
- Добавить строку: «Улучшены сообщения об ошибках SSH (подсказки для publickey/host key/доступа), README обновлён под Ed25519 и KEYSLOTH_SSH_KEY_PATH».

#### 5) Быстрая ручная проверка
- `KEYSLOTH_SSH_KEY_PATH` с реальным ed25519 ключом → `pull`/`push` проходят.
- Без ENV, c системным ssh-agent и `id_ed25519` → работает «из коробки».
- Смоделировать ошибку `Permission denied (publickey)` и убедиться, что подсказки видны и полезны.

---

### Критерии приёмки
- README обновлён (ed25519, KEYSLOTH_SSH_KEY_PATH, ENV‑примеры).
- Сообщения об ошибках SSH расширены и сохраняют безопасность.
- Добавлены/прогнаны спеки на типовые сценарии (если возможно).
- CHANGELOG обновлён.

### Риски и откат
- Риск «шумных» сообщений для редких ошибок — ограничиваемся известными паттернами.
- Откат: вернуть прежнюю версию `run_git`, удалить новые спеки и строку в CHANGELOG; документацию откатить соответствующим PR.

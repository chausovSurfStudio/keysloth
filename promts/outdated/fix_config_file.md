# Исправление: игнорируется branch/local_path из .keyslothrc при вызове CLI

## Признаки
- При наличии `.keyslothrc` значения `branch` и `local_path` из файла конфигурации не применяются при `pull`/`push`.
- CLI прокидывает дефолты (`branch: 'main'`, `path: './secrets'`) в корневые методы, тем самым перекрывая конфиг.
- Автопоиск конфига есть (текущий каталог и `~/.keyslothrc`).

## Требования (см. promts/main/rules.md)
- Добавить тест(ы), воспроизводящие баг (красные до фикса).
- Исправить код так, чтобы параметры из `.keyslothrc` учитывались, а CLI‑дефолты не перекрывали их.
- Убедиться, что все тесты проходят.
- Обновить `CHANGELOG.md` под текущую версию из `lib/keysloth/version.rb`.
- Обновить документацию: README — пояснить автопоиск `.keyslothrc`.

## План работ
1) Тесты (красные):
   - В `spec/keysloth_spec.rb` добавить кейсы для `.pull` и `.push`:
     - Мок `KeySloth::Config.load` возвращает конфиг с `branch: 'develop'`, `local_path: './conf_secrets'`.
     - Вызов `.pull(repo_url: 'x', password: 'y', branch: nil, local_path: nil, config_file: '.keyslothrc')` должен после мерджа отдать `branch='develop'`, `local_path='./conf_secrets'` в `GitManager/FileManager`.
     - Аналогично для `.push`.
   - Альтернативно (на уровне CLI): тесты в `spec/keysloth/cli_spec.rb`, что при отсутствии указанных пользователем `--branch/--path` CLI не прокидывает дефолты, позволяя конфигу примениться.

2) Исправление мерджа параметров:
   - В `lib/keysloth/cli.rb`:
     - Убрать дефолты у опций `:branch` и `:path` для команд `pull`/`push`/других, где нужно применять конфиг. Оставить только `desc` и `type`.
     - В вызове `KeySloth.pull/push` передавать `branch: options[:branch], local_path: options[:path]` как есть (могут быть `nil`).
   - В `lib/keysloth.rb` (методы `.pull` и `.push`):
     - При формировании `merged_config = config.merge({...}.compact)` — НЕ задавать свои дефолты в сигнатуре метода (оставить `branch: nil` и `local_path: nil`), чтобы при `nil` бралось из `config`.
     - Сохранять текущую логику приоритета: явные аргументы пользователя перекрывают конфиг, а `nil` не перетирает.

3) Прогон тестов:
   - `bundle exec rake spec` — все тесты должны стать зелёными.
   - При необходимости — исправить тесты/код, не нарушая приоритетов параметров.

4) Документация и ченджлог:
   - В `README.md` дополнить раздел «Конфигурационный файл»:
     - Явно указать автопоиск: текущая директория и `~/.keyslothrc`.
     - Уточнить приоритеты: CLI > конфиг > значения по умолчанию.
     - Явно указать дефолты при отсутствии флагов и полей в конфиге: `branch: 'main'`, `local_path: './secrets'`, `backup_count: 3` (у `repo_url` дефолта нет).
   - В `CHANGELOG.md` для версии `0.2.0` (или актуальной) добавить запись:
     - Исправлено: игнорирование `branch` и `local_path` из `.keyslothrc` при использовании CLI.

## Критерии приёмки
- Без явных `--branch/--path` и с `.keyslothrc` значения из конфига применяются в `pull`/`push`.
- С явными флагами CLI значения из конфига перекрываются флагами.
- При отсутствии файла конфига — используются дефолты (из `Config::DEFAULT_CONFIG`).
- Тесты и линт проходят.
